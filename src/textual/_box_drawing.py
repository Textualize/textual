from functools import lru_cache

from typing_extensions import TypeAlias

Quad: TypeAlias = tuple[int, int, int, int]

BOX_CHARACTERS: dict[Quad, str] = {
    (0, 0, 0, 0): " ",
    (0, 0, 0, 1): "╴",
    (0, 0, 0, 2): "╸",
    (0, 0, 0, 3): "╸",
    #
    (0, 0, 1, 0): "╷",
    (0, 0, 1, 1): "┐",
    (0, 0, 1, 2): "┑",
    (0, 0, 1, 3): "╕",
    #
    (0, 0, 2, 0): "╻",
    (0, 0, 2, 1): "┒",
    (0, 0, 2, 2): "┓",
    (0, 0, 2, 3): "╕",
    #
    (0, 0, 3, 0): "╻",
    (0, 0, 3, 1): "╖",
    (0, 0, 3, 2): "╖",
    (0, 0, 3, 3): "╗",
    #
    (0, 1, 0, 0): "╶",
    (0, 1, 0, 1): "─",
    (0, 1, 0, 2): "╼",
    (0, 1, 0, 3): "╼",
    #
    (0, 1, 1, 0): "┌",
    (0, 1, 1, 1): "┬",
    (0, 1, 1, 2): "┭",
    (0, 1, 1, 3): "╤",
    #
    (0, 1, 2, 0): "┎",
    (0, 1, 2, 1): "┰",
    (0, 1, 2, 2): "┱",
    (0, 1, 2, 3): "┱",
    #
    (0, 1, 3, 0): "╓",
    (0, 1, 3, 1): "╥",
    (0, 1, 3, 2): "╥",
    (0, 1, 3, 3): "╥",
    #
    (0, 2, 0, 0): "╺",
    (0, 2, 0, 1): "╾",
    (0, 2, 0, 2): "━",
    (0, 2, 0, 3): "━",
    #
    (0, 2, 1, 0): "┍",
    (0, 2, 1, 1): "┮",
    (0, 2, 1, 2): "┯",
    (0, 2, 1, 3): "┯",
    #
    (0, 2, 2, 0): "┏",
    (0, 2, 2, 1): "┲",
    (0, 2, 2, 2): "┳",
    (0, 2, 2, 3): "╦",
    #
    (0, 2, 3, 0): "╒",
    (0, 2, 3, 1): "╥",
    (0, 2, 3, 2): "╥",
    (0, 2, 3, 3): "╦",
    #
    (0, 3, 0, 0): "╺",
    (0, 3, 0, 1): "╾",
    (0, 3, 0, 2): "╾",
    (0, 3, 0, 3): "═",
    #
    (0, 3, 1, 0): "╒",
    (0, 3, 1, 1): "╤",
    (0, 3, 1, 2): "╤",
    (0, 3, 1, 3): "╤",
    #
    (0, 3, 2, 0): "╒",
    (0, 3, 2, 1): "╤",
    (0, 3, 2, 2): "╤",
    (0, 3, 2, 3): "╤",
    #
    (0, 3, 3, 0): "╔",
    (0, 3, 3, 1): "╦",
    (0, 3, 3, 2): "╦",
    (0, 3, 3, 3): "╦",
    #
    (1, 0, 0, 0): "╵",
    (1, 0, 0, 1): "┘",
    (1, 0, 0, 2): "┙",
    (1, 0, 0, 3): "╛",
    #
    (1, 0, 1, 0): "│",
    (1, 0, 1, 1): "┤",
    (1, 0, 1, 2): "┥",
    (1, 0, 1, 3): "╡",
    #
    (1, 0, 2, 0): "╽",
    (1, 0, 2, 1): "┧",
    (1, 0, 2, 2): "┪",
    (1, 0, 2, 3): "┪",
    #
    (1, 0, 3, 0): "╽",
    (1, 0, 3, 1): "┧",
    (1, 0, 3, 2): "┪",
    (1, 0, 3, 3): "┪",
    #
    (1, 1, 0, 0): "└",
    (1, 1, 0, 1): "┴",
    (1, 1, 0, 2): "┵",
    (1, 1, 0, 3): "┵",
    #
    (1, 1, 1, 0): "├",
    (1, 1, 1, 1): "┼",
    (1, 1, 1, 2): "┽",
    (1, 1, 1, 3): "┽",
    #
    (1, 1, 2, 0): "┟",
    (1, 1, 2, 1): "╁",
    (1, 1, 2, 2): "╅",
    (1, 1, 2, 3): "╅",
    #
    (1, 1, 3, 0): "┟",
    (1, 1, 3, 1): "╁",
    (1, 1, 3, 2): "╅",
    (1, 1, 3, 3): "╅",
    #
    (1, 2, 0, 0): "┕",
    (1, 2, 0, 1): "┶",
    (1, 2, 0, 2): "┷",
    (1, 2, 0, 3): "╧",
    #
    (1, 2, 1, 0): "┝",
    (1, 2, 1, 1): "┾",
    (1, 2, 1, 2): "┿",
    (1, 2, 1, 3): "┿",
    #
    (1, 2, 2, 0): "┢",
    (1, 2, 2, 1): "╆",
    (1, 2, 2, 2): "╈",
    (1, 2, 2, 3): "╈",
    #
    (1, 2, 3, 0): "┢",
    (1, 2, 3, 1): "╆",
    (1, 2, 3, 2): "╈",
    (1, 2, 3, 3): "╈",
    #
    (1, 3, 0, 0): "╘",
    (1, 3, 0, 1): "╧",
    (1, 3, 0, 2): "╧",
    (1, 3, 0, 3): "╧",
    #
    (1, 3, 1, 0): "╞",
    (1, 3, 1, 1): "╬",
    (1, 3, 1, 2): "╪",
    (1, 3, 1, 3): "╪",
    #
    (1, 3, 2, 0): "╟",
    (1, 3, 2, 1): "┾",
    (1, 3, 2, 2): "┾",
    (1, 3, 2, 3): "╪",
    #
    (1, 3, 3, 0): "╞",
    (1, 3, 3, 1): "╆",
    (1, 3, 3, 2): "╆",
    (1, 3, 3, 3): "╈",
    #
    (2, 0, 0, 0): "╹",
    (2, 0, 0, 1): "┚",
    (2, 0, 0, 2): "┛",
    (2, 0, 0, 3): "╛",
    #
    (2, 0, 1, 0): "╿",
    (2, 0, 1, 1): "┦",
    (2, 0, 1, 2): "┩",
    (2, 0, 1, 3): "┩",
    #
    (2, 0, 2, 0): "┃",
    (2, 0, 2, 1): "┨",
    (2, 0, 2, 2): "┫",
    (2, 0, 2, 3): "╢",
    #
    (2, 0, 3, 0): "║",
    (2, 0, 3, 1): "╢",
    (2, 0, 3, 2): "╢",
    (2, 0, 3, 3): "╢",
    #
    (2, 1, 0, 0): "┖",
    (2, 1, 0, 1): "┸",
    (2, 1, 0, 2): "┹",
    (2, 1, 0, 3): "┹",
    #
    (2, 1, 1, 0): "╀",
    (2, 1, 1, 1): "╀",
    (2, 1, 1, 2): "╃",
    (2, 1, 1, 3): "╃",
    #
    (2, 1, 2, 0): "┠",
    (2, 1, 2, 1): "╂",
    (2, 1, 2, 2): "╉",
    (2, 1, 2, 3): "╉",
    #
    (2, 1, 3, 0): "╟",
    (2, 1, 3, 1): "╫",
    (2, 1, 3, 2): "╫",
    (2, 1, 3, 3): "╫",
    #
    (2, 2, 0, 0): "┗",
    (2, 2, 0, 1): "┺",
    (2, 2, 0, 2): "┻",
    (2, 2, 0, 3): "┻",
    #
    (2, 2, 1, 0): "┡",
    (2, 2, 1, 1): "╄",
    (2, 2, 1, 2): "╇",
    (2, 2, 1, 3): "╇",
    #
    (2, 2, 2, 0): "┣",
    (2, 2, 2, 1): "╊",
    (2, 2, 2, 2): "╋",
    (2, 2, 2, 3): "╬",
    #
    (2, 2, 3, 0): "╠",
    (2, 2, 3, 1): "╬",
    (2, 2, 3, 2): "╬",
    (2, 2, 3, 3): "╬",
    #
    (2, 3, 0, 0): "╚",
    (2, 3, 0, 1): "╩",
    (2, 3, 0, 2): "╩",
    (2, 3, 0, 3): "╩",
    #
    (2, 3, 1, 0): "╞",
    (2, 3, 1, 1): "╬",
    (2, 3, 1, 2): "╬",
    (2, 3, 1, 3): "╬",
    #
    (2, 3, 2, 0): "╞",
    (2, 3, 2, 1): "╬",
    (2, 3, 2, 2): "╬",
    (2, 3, 2, 3): "╬",
    #
    (2, 3, 3, 0): "╠",
    (2, 3, 3, 1): "╬",
    (2, 3, 3, 2): "╬",
    (2, 3, 3, 3): "╬",
    #
    (3, 0, 0, 0): "╹",
    (3, 0, 0, 1): "╜",
    (3, 0, 0, 2): "╜",
    (3, 0, 0, 3): "╝",
    #
    (3, 0, 1, 0): "╿",
    (3, 0, 1, 1): "┦",
    (3, 0, 1, 2): "┦",
    (3, 0, 1, 3): "┩",
    #
    (3, 0, 2, 0): "║",
    (3, 0, 2, 1): "╢",
    (3, 0, 2, 2): "╢",
    (3, 0, 2, 3): "╣",
    #
    (3, 0, 3, 0): "║",
    (3, 0, 3, 1): "╢",
    (3, 0, 3, 2): "╢",
    (3, 0, 3, 3): "╣",
    #
    (3, 1, 0, 0): "╙",
    (3, 1, 0, 1): "╨",
    (3, 1, 0, 2): "╨",
    (3, 1, 0, 3): "╩",
    #
    (3, 1, 1, 0): "╟",
    (3, 1, 1, 1): "╬",
    (3, 1, 1, 2): "╬",
    (3, 1, 1, 3): "╬",
    #
    (3, 1, 2, 0): "╟",
    (3, 1, 2, 1): "╬",
    (3, 1, 2, 2): "╬",
    (3, 1, 2, 3): "╬",
    #
    (3, 1, 3, 0): "╟",
    (3, 1, 3, 1): "╫",
    (3, 1, 3, 2): "╫",
    (3, 1, 3, 3): "╉",
    #
    (3, 2, 0, 0): "╙",
    (3, 2, 0, 1): "╨",
    (3, 2, 0, 2): "╨",
    (3, 2, 0, 3): "╩",
    #
    (3, 2, 1, 0): "╟",
    (3, 2, 1, 1): "╬",
    (3, 2, 1, 2): "╬",
    (3, 2, 1, 3): "╬",
    #
    (3, 2, 2, 0): "╟",
    (3, 2, 2, 1): "╬",
    (3, 2, 2, 2): "╬",
    (3, 2, 2, 3): "╬",
    #
    (3, 2, 3, 0): "╟",
    (3, 2, 3, 1): "╫",
    (3, 2, 3, 2): "╫",
    (3, 2, 3, 3): "╬",
    #
    (3, 3, 0, 0): "╚",
    (3, 3, 0, 1): "╩",
    (3, 3, 0, 2): "╩",
    (3, 3, 0, 3): "╩",
    #
    (3, 3, 1, 0): "╠",
    (3, 3, 1, 1): "╄",
    (3, 3, 1, 2): "╄",
    (3, 3, 1, 3): "╇",
    #
    (3, 3, 2, 0): "╠",
    (3, 3, 2, 1): "╬",
    (3, 3, 2, 2): "╬",
    (3, 3, 2, 3): "╬",
    #
    (3, 3, 3, 0): "╊",
    (3, 3, 3, 1): "╊",
    (3, 3, 3, 2): "╬",
    (3, 3, 3, 3): "╬",
}

REVERSE_BOX_CHARACTERS: dict[str, Quad] = {
    character: quad for quad, character in sorted(BOX_CHARACTERS.items(), reverse=True)
}


@lru_cache(1024)
def box_combine(box1: str, box2: str) -> str:
    """Combine two box drawing characters.

    Args:
        box1: Existing box character.
        box2: New box drawing character.

    Returns:
        A new box drawing character.
    """
    top1, right1, bottom1, left1 = REVERSE_BOX_CHARACTERS.get(box1, (0, 0, 0, 0))
    top2, right2, bottom2, left2 = REVERSE_BOX_CHARACTERS.get(box2, (0, 0, 0, 0))
    return BOX_CHARACTERS[
        (
            top2 or top1,
            right2 or right1,
            bottom2 or bottom1,
            left2 or left1,
        )
    ]


@lru_cache(1024)
def box_combine_quads(box1: Quad, box2: Quad) -> Quad:
    """Combine two box drawing characters.

    Args:
        box1: Existing box character.
        box2: New box drawing character.

    Returns:
        A new box drawing character.
    """
    top1, right1, bottom1, left1 = box1
    top2, right2, bottom2, left2 = box2
    return (
        top2 or top1,
        right2 or right1,
        bottom2 or bottom1,
        left2 or left1,
    )


if __name__ == "__main__":
    print(box_combine("│", "─"))
    print(box_combine("╹", "╶"))

    print(REVERSE_BOX_CHARACTERS["╹"])
    print(REVERSE_BOX_CHARACTERS["╶"])
